function validate(arrobj){
  if(!Array.isArray(arrobj)) throw Error('Array of objects, not an array');
  if(!arrobj.length) throw Error('Array of objects, contains no objects');
  
  var keys =Object.keys(arrobj[0]);
  arrobj.forEach((row)=>{
    if(JSON.stringify(keys) !== JSON.stringify(Object.keys(row)))
      throw Error('Array of objects, dissimilar keys ' + keys + JSON.stringify(row));
  });
}

function process(obj, fields){
  var arr = [];
  fields.forEach((k)=>arr.push(obj[k]));
  return arr;
}

module.exports = (arrobj)=>{
  validate(arrobj);
  var ret = [Object.keys(arrobj[0])];
  arrobj.forEach((obj)=>ret.push(process(obj, ret[0])));
  return ret;
};